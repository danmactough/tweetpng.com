// Generated by CoffeeScript 1.4.0
var cheerio, request;

request = require("request");

cheerio = require("cheerio");

module.exports = function(app) {
  return app.get("/:username/status/:id", function(req, res) {
    var url;
    url = "https://twitter.com/" + req.params.username + "/status/" + req.params.id;
    console.log(url);
    return request(url, function(err, rrr, body) {
      var $, avatarURL, fullName, timeStamp, tweet, userName;
      $ = cheerio.load(body);
      tweet = $(".permalink-tweet .tweet-text").html();
      fullName = $(".permalink-header .fullname").html();
      userName = $(".permalink-header .username").html();
      timeStamp = "";
      avatarURL = $(".permalink-header a img").attr("src");
      if (fullName === null) {
        tweet = "This user's tweet is protected or not available.";
        avatarURL = "/images/protected.png";
      }
      return res.render("tweet", {
        fullName: fullName,
        userName: userName,
        timeStamp: timeStamp,
        tweet: tweet,
        avatarURL: avatarURL
      });
    });
  });
};
