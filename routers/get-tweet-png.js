// Generated by CoffeeScript 1.4.0
var webshot;

webshot = require("webshot");

module.exports = function(app) {
  return app.get("/:username/tweet/:tweet.png", function(req, res) {
    var opt, url;
    url = "";
    opt = {
      screenSize: {
        width: 550,
        height: 75
      },
      shotSize: {
        width: 550,
        height: "all"
      }
    };
    if (req.params.tweet === "last") {
      url = "http://" + req.headers.host + "/" + req.params.username + "/last";
      return webshot(url, opt, function(err, renderStream) {
        var img;
        img = "";
        renderStream.on("data", function(data) {
          return img += data.toString("binary");
        });
        return renderStream.on("end", function() {
          res.setHeader("Content-Type", "image/png");
          res.writeHead(200);
          res.write(img, "binary");
          return res.end();
        });
      });
    } else {
      url = "http://" + req.headers.host + "/" + req.params.username + "/status/" + req.params.tweet;
      return webshot(url, opt, function(err, renderStream) {
        var img;
        img = "";
        renderStream.on("data", function(data) {
          return img += data.toString("binary");
        });
        return renderStream.on("end", function() {
          res.setHeader("Content-Type", "image/png");
          res.writeHead(200);
          res.write(img, "binary");
          return res.end();
        });
      });
    }
  });
};
